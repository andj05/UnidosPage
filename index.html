<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yayeros Unidos - Sistema de Estadísticas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo h1 {
            color: #1e3c72;
            font-size: 2rem;
            font-weight: bold;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
        }

        .nav-btn {
            padding: 0.5rem 1.5rem;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-card h3 {
            color: #1e3c72;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .table th {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }

        .table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #1e3c72;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            transform: translateY(-1px);
        }

        .player-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .player-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #1e3c72;
        }

        .player-info h3 {
            color: #1e3c72;
            margin-bottom: 0.5rem;
        }

        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: white;
            font-size: 1.2rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .container {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .player-card {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <h1>⚾ Yayeros Unidos</h1>
            </div>
            <nav class="nav-menu">
                <button class="nav-btn active" onclick="showSection('dashboard')">Dashboard</button>
                <button class="nav-btn" onclick="showSection('jugadores')">Jugadores</button>
                <button class="nav-btn" onclick="showSection('juegos')">Juegos</button>
                <button class="nav-btn" onclick="showSection('estadisticas')">Estadísticas</button>
                <button class="nav-btn" onclick="showSection('premios')">Premios</button>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <h2 style="color: white; margin-bottom: 2rem; font-size: 2.5rem; text-align: center;">Dashboard - Temporada 2025</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Jugadores Activos</h3>
                    <div class="stat-number" id="total-jugadores">0</div>
                    <div class="stat-label">Total Roster</div>
                </div>
                <div class="stat-card">
                    <h3>Juegos Jugados</h3>
                    <div class="stat-number" id="total-juegos">0</div>
                    <div class="stat-label">Esta Temporada</div>
                </div>
                <div class="stat-card">
                    <h3>Victorias</h3>
                    <div class="stat-number" id="total-victorias">0</div>
                    <div class="stat-label">Ganados</div>
                </div>
                <div class="stat-card">
                    <h3>Promedio Equipo</h3>
                    <div class="stat-number" id="promedio-equipo">.000</div>
                    <div class="stat-label">Bateo</div>
                </div>
            </div>

            <div class="table-container">
                <h3>Líderes de Bateo</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Jugador</th>
                            <th>AVG</th>
                            <th>HR</th>
                            <th>RBI</th>
                            <th>H</th>
                        </tr>
                    </thead>
                    <tbody id="lideres-bateo">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 2rem;">Cargando datos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Jugadores Section -->
        <section id="jugadores" class="section">
            <h2 style="color: white; margin-bottom: 2rem; font-size: 2.5rem;">Gestión de Jugadores</h2>
            
            <div class="form-container">
                <h3>Registrar Nuevo Jugador</h3>
                <form id="form-jugador">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="numero-jugador">Número de Camiseta</label>
                            <input type="number" id="numero-jugador" required>
                        </div>
                        <div class="form-group">
                            <label for="nombre-jugador">Nombre</label>
                            <input type="text" id="nombre-jugador" required>
                        </div>
                        <div class="form-group">
                            <label for="apellido-jugador">Apellido</label>
                            <input type="text" id="apellido-jugador" required>
                        </div>
                        <div class="form-group">
                            <label for="posicion-primaria">Posición Primaria</label>
                            <select id="posicion-primaria" required>
                                <option value="">Seleccionar posición</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="telefono-jugador">Teléfono</label>
                            <input type="tel" id="telefono-jugador">
                        </div>
                        <div class="form-group">
                            <label for="email-jugador">Email</label>
                            <input type="email" id="email-jugador">
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Registrar Jugador</button>
                </form>
            </div>

            <div class="table-container">
                <h3>Roster Actual</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Posición</th>
                            <th>Teléfono</th>
                            <th>Email</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="lista-jugadores">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 2rem;">Cargando jugadores...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Juegos Section -->
        <section id="juegos" class="section">
            <h2 style="color: white; margin-bottom: 2rem; font-size: 2.5rem;">Gestión de Juegos</h2>
            
            <div class="form-container">
                <h3>Registrar Nuevo Juego</h3>
                <form id="form-juego">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="fecha-juego">Fecha del Juego</label>
                            <input type="date" id="fecha-juego" required>
                        </div>
                        <div class="form-group">
                            <label for="equipo-contrario">Equipo Contrario</label>
                            <select id="equipo-contrario" required>
                                <option value="">Seleccionar equipo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="carreras-yayeros">Carreras Yayeros</label>
                            <input type="number" id="carreras-yayeros" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="carreras-contrario">Carreras Contrarios</label>
                            <input type="number" id="carreras-contrario" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="ubicacion-juego">Ubicación</label>
                            <input type="text" id="ubicacion-juego" required>
                        </div>
                        <div class="form-group">
                            <label for="es-local">Tipo de Juego</label>
                            <select id="es-local" required>
                                <option value="">Seleccionar</option>
                                <option value="true">Local</option>
                                <option value="false">Visitante</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Registrar Juego</button>
                </form>
            </div>

            <div class="table-container">
                <h3>Historial de Juegos</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Vs</th>
                            <th>Resultado</th>
                            <th>Ubicación</th>
                            <th>Tipo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="lista-juegos">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 2rem;">Cargando juegos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Estadísticas Section -->
        <section id="estadisticas" class="section">
            <h2 style="color: white; margin-bottom: 2rem; font-size: 2.5rem;">Estadísticas de Bateo</h2>
            
            <div class="form-container">
                <h3>Registrar Estadísticas de Bateo</h3>
                <form id="form-estadisticas">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="jugador-estadistica">Jugador</label>
                            <select id="jugador-estadistica" required>
                                <option value="">Seleccionar jugador</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="juego-estadistica">Juego</label>
                            <select id="juego-estadistica" required>
                                <option value="">Seleccionar juego</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="turnos-bate">Turnos al Bate</label>
                            <input type="number" id="turnos-bate" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="hits">Hits</label>
                            <input type="number" id="hits" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="dobles">Dobles</label>
                            <input type="number" id="dobles" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="triples">Triples</label>
                            <input type="number" id="triples" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="homeruns">Home Runs</label>
                            <input type="number" id="homeruns" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label for="rbi">RBI</label>
                            <input type="number" id="rbi" min="0" value="0">
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Registrar Estadísticas</button>
                </form>
            </div>
        </section>

        <!-- Premios Section -->
        <section id="premios" class="section">
            <h2 style="color: white; margin-bottom: 2rem; font-size: 2.5rem;">Premios Anuales</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>🏆 Jugador Más Valioso</h3>
                    <div class="stat-number" id="mvp-jugador">TBD</div>
                    <div class="stat-label">MVP 2025</div>
                </div>
                <div class="stat-card">
                    <h3>💥 Líder en Home Runs</h3>
                    <div class="stat-number" id="hr-leader">0</div>
                    <div class="stat-label">Home Runs</div>
                </div>
                <div class="stat-card">
                    <h3>📊 Mejor Promedio</h3>
                    <div class="stat-number" id="avg-leader">.000</div>
                    <div class="stat-label">Promedio</div>
                </div>
                <div class="stat-card">
                    <h3>🚀 Más RBI</h3>
                    <div class="stat-number" id="rbi-leader">0</div>
                    <div class="stat-label">Carreras Impulsadas</div>
                </div>
            </div>
        </section>
    </main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
            // Configuración de Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyARK4R62bM5hO7chCgg8syZHVQq7ZTGdAg",
        authDomain: "softball-stats-c786a.firebaseapp.com",
        databaseURL: "https://softball-stats-c786a-default-rtdb.firebaseio.com",
        projectId: "softball-stats-c786a",
        storageBucket: "softball-stats-c786a.firebasestorage.app",
        messagingSenderId: "587645625152",
        appId: "1:587645625152:web:89bcc8b309cec0dc2b50a5",
        measurementId: "G-TBQ7SJZQQ4"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
        // Variables globales
        let jugadores = [];
        let juegos = [];
        let estadisticas = [];
        let posiciones = [];
        let equiposContrarios = [];

        // Función para mostrar secciones
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la sección seleccionada
            document.getElementById(sectionId).classList.add('active');
            
            // Actualizar botones de navegación
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Función para cargar datos iniciales
        async function cargarDatosIniciales() {
            try {
                // Cargar posiciones
                await cargarPosiciones();
                
                // Cargar equipos contrarios
                await cargarEquiposContrarios();
                
                // Cargar jugadores
                await cargarJugadores();
                
                // Cargar juegos
                await cargarJuegos();
                
                // Cargar estadísticas
                await cargarEstadisticas();
                
                // Actualizar dashboard
                actualizarDashboard();
                
            } catch (error) {
                console.error('Error cargando datos iniciales:', error);
            }
        }

        // Función para cargar posiciones
        async function cargarPosiciones() {
            try {
                const posicionesSnapshot = await db.collection('posiciones').get();
                posiciones = posicionesSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Si no hay posiciones, crear las básicas
                if (posiciones.length === 0) {
                    const posicionesBasicas = [
                        { nombre: 'Pitcher', descripcion: 'Lanzador' },
                        { nombre: 'Catcher', descripcion: 'Receptor' },
                        { nombre: 'Primera Base', descripcion: 'Primera base' },
                        { nombre: 'Segunda Base', descripcion: 'Segunda base' },
                        { nombre: 'Tercera Base', descripcion: 'Tercera base' },
                        { nombre: 'Short Stop', descripcion: 'Parador en corto' },
                        { nombre: 'Left Field', descripcion: 'Jardín izquierdo' },
                        { nombre: 'Center Field', descripcion: 'Jardín central' },
                        { nombre: 'Right Field', descripcion: 'Jardín derecho' },
                        { nombre: 'Utility', descripcion: 'Utilidad' }
                    ];
                    
                    for (const posicion of posicionesBasicas) {
                        const docRef = await db.collection('posiciones').add(posicion);
                        posiciones.push({ id: docRef.id, ...posicion });
                    }
                }
                
                // Actualizar select de posiciones
                const selectPosicion = document.getElementById('posicion-primaria');
                selectPosicion.innerHTML = '<option value="">Seleccionar posición</option>';
                posiciones.forEach(posicion => {
                    const option = document.createElement('option');
                    option.value = posicion.id;
                    option.textContent = posicion.nombre;
                    selectPosicion.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error cargando posiciones:', error);
            }
        }

        // Función para cargar equipos contrarios
        async function cargarEquiposContrarios() {
            try {
                const equiposSnapshot = await db.collection('equipos-contrarios').get();
                equiposContrarios = equiposSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Si no hay equipos, crear algunos de ejemplo
                if (equiposContrarios.length === 0) {
                    const equiposEjemplo = [
                        { nombre: 'Tigres del Este', ciudad: 'Santiago' },
                        { nombre: 'Leones del Cibao', ciudad: 'La Vega' },
                        { nombre: 'Águilas Cibaeñas', ciudad: 'Santiago' },
                        { nombre: 'Toros del Este', ciudad: 'La Romana' }
                    ];
                    
                    for (const equipo of equiposEjemplo) {
                        const docRef = await db.collection('equipos-contrarios').add(equipo);
                        equiposContrarios.push({ id: docRef.id, ...equipo });
                    }
                }
                
                // Actualizar select de equipos
                const selectEquipo = document.getElementById('equipo-contrario');
                selectEquipo.innerHTML = '<option value="">Seleccionar equipo</option>';
                equiposContrarios.forEach(equipo => {
                    const option = document.createElement('option');
                    option.value = equipo.id;
                    option.textContent = equipo.nombre;
                    selectEquipo.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error cargando equipos contrarios:', error);
            }
        }

        // Función para cargar jugadores
        async function cargarJugadores() {
            try {
                const jugadoresSnapshot = await db.collection('jugadores').get();
                jugadores = jugadoresSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Actualizar tabla de jugadores
                const tbody = document.getElementById('lista-jugadores');
                if (jugadores.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No hay jugadores registrados</td></tr>';
                } else {
                    tbody.innerHTML = jugadores.map(jugador => {
                        const posicion = posiciones.find(p => p.id === jugador.posicionPrimariaId);
                        return `
                            <tr>
                                <td><strong>#${jugador.numeroJugador}</strong></td>
                                <td>${jugador.nombre} ${jugador.apellido}</td>
                                <td>${posicion ? posicion.nombre : 'N/A'}</td>
                                <td>${jugador.telefono || 'N/A'}</td>
                                <td>${jugador.email || 'N/A'}</td>
                                <td>
                                    <button class="btn-secondary" onclick="editarJugador('${jugador.id}')">Editar</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Actualizar selects de jugadores
                actualizarSelectsJugadores();
                
            } catch (error) {
                console.error('Error cargando jugadores:', error);
            }
        }

        // Función para actualizar selects de jugadores
        function actualizarSelectsJugadores() {
            const selectJugador = document.getElementById('jugador-estadistica');
            selectJugador.innerHTML = '<option value="">Seleccionar jugador</option>';
            jugadores.forEach(jugador => {
                const option = document.createElement('option');
                option.value = jugador.id;
                option.textContent = `#${jugador.numeroJugador} - ${jugador.nombre} ${jugador.apellido}`;
                selectJugador.appendChild(option);
            });
        }

        // Función para cargar juegos
        async function cargarJuegos() {
            try {
                const juegosSnapshot = await db.collection('juegos').orderBy('fecha', 'desc').get();
                juegos = juegosSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Actualizar tabla de juegos
                const tbody = document.getElementById('lista-juegos');
                if (juegos.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No hay juegos registrados</td></tr>';
                } else {
                    tbody.innerHTML = juegos.map(juego => {
                        const equipo = equiposContrarios.find(e => e.id === juego.equipoContrarioId);
                        const resultado = juego.carrerasYayeros > juego.carrerasContrario ? 'Victoria' : 'Derrota';
                        const resultadoColor = resultado === 'Victoria' ? 'color: #28a745; font-weight: bold;' : 'color: #dc3545; font-weight: bold;';
                        
                        return `
                            <tr>
                                <td>${new Date(juego.fecha.toDate()).toLocaleDateString()}</td>
                                <td>${equipo ? equipo.nombre : 'N/A'}</td>
                                <td style="${resultadoColor}">${juego.carrerasYayeros} - ${juego.carrerasContrario} (${resultado})</td>
                                <td>${juego.ubicacion}</td>
                                <td>${juego.esLocal ? 'Local' : 'Visitante'}</td>
                                <td>
                                    <button class="btn-secondary" onclick="verDetallesJuego('${juego.id}')">Ver</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Actualizar select de juegos para estadísticas
                const selectJuego = document.getElementById('juego-estadistica');
                selectJuego.innerHTML = '<option value="">Seleccionar juego</option>';
                juegos.forEach(juego => {
                    const equipo = equiposContrarios.find(e => e.id === juego.equipoContrarioId);
                    const fecha = new Date(juego.fecha.toDate()).toLocaleDateString();
                    const option = document.createElement('option');
                    option.value = juego.id;
                    option.textContent = `${fecha} vs ${equipo ? equipo.nombre : 'N/A'}`;
                    selectJuego.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error cargando juegos:', error);
            }
        }

        // Función para cargar estadísticas
        async function cargarEstadisticas() {
            try {
                const estadisticasSnapshot = await db.collection('estadisticas-bateo').get();
                estadisticas = estadisticasSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
            } catch (error) {
                console.error('Error cargando estadísticas:', error);
            }
        }

        // Función para actualizar dashboard
        function actualizarDashboard() {
            // Total jugadores
            document.getElementById('total-jugadores').textContent = jugadores.length;
            
            // Total juegos
            document.getElementById('total-juegos').textContent = juegos.length;
            
            // Total victorias
            const victorias = juegos.filter(juego => juego.carrerasYayeros > juego.carrerasContrario).length;
            document.getElementById('total-victorias').textContent = victorias;
            
            // Calcular promedio del equipo
            if (estadisticas.length > 0) {
                const totalTurnos = estadisticas.reduce((sum, est) => sum + (est.turnosAlBate || 0), 0);
                const totalHits = estadisticas.reduce((sum, est) => sum + (est.hits || 0), 0);
                const promedioEquipo = totalTurnos > 0 ? (totalHits / totalTurnos).toFixed(3) : '.000';
                document.getElementById('promedio-equipo').textContent = promedioEquipo;
            }
            
            // Actualizar tabla de líderes
            actualizarLideresBateo();
        }

        // Función para actualizar líderes de bateo
        function actualizarLideresBateo() {
            const tbody = document.getElementById('lideres-bateo');
            
            if (estadisticas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem;">No hay estadísticas registradas</td></tr>';
                return;
            }
            
            // Agrupar estadísticas por jugador
            const estadisticasPorJugador = {};
            estadisticas.forEach(est => {
                if (!estadisticasPorJugador[est.jugadorId]) {
                    estadisticasPorJugador[est.jugadorId] = {
                        turnosAlBate: 0,
                        hits: 0,
                        homeRuns: 0,
                        rbi: 0
                    };
                }
                estadisticasPorJugador[est.jugadorId].turnosAlBate += est.turnosAlBate || 0;
                estadisticasPorJugador[est.jugadorId].hits += est.hits || 0;
                estadisticasPorJugador[est.jugadorId].homeRuns += est.homeRuns || 0;
                estadisticasPorJugador[est.jugadorId].rbi += est.rbi || 0;
            });
            
            // Convertir a array y calcular promedios
            const lideres = Object.keys(estadisticasPorJugador).map(jugadorId => {
                const jugador = jugadores.find(j => j.id === jugadorId);
                const stats = estadisticasPorJugador[jugadorId];
                const promedio = stats.turnosAlBate > 0 ? (stats.hits / stats.turnosAlBate).toFixed(3) : '.000';
                
                return {
                    jugador: jugador ? `${jugador.nombre} ${jugador.apellido}` : 'N/A',
                    promedio: promedio,
                    homeRuns: stats.homeRuns,
                    rbi: stats.rbi,
                    hits: stats.hits
                };
            });
            
            // Ordenar por promedio de bateo
            lideres.sort((a, b) => parseFloat(b.promedio) - parseFloat(a.promedio));
            
            // Mostrar top 5
            const top5 = lideres.slice(0, 5);
            tbody.innerHTML = top5.map(lider => `
                <tr>
                    <td>${lider.jugador}</td>
                    <td><strong>${lider.promedio}</strong></td>
                    <td>${lider.homeRuns}</td>
                    <td>${lider.rbi}</td>
                    <td>${lider.hits}</td>
                </tr>
            `).join('');
        }

        // Event listeners para formularios
        document.getElementById('form-jugador').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const jugadorData = {
                    numeroJugador: parseInt(document.getElementById('numero-jugador').value),
                    nombre: document.getElementById('nombre-jugador').value,
                    apellido: document.getElementById('apellido-jugador').value,
                    posicionPrimariaId: document.getElementById('posicion-primaria').value,
                    telefono: document.getElementById('telefono-jugador').value,
                    email: document.getElementById('email-jugador').value,
                    fechaIngreso: firebase.firestore.Timestamp.now(),
                    activo: true
                };
                
                await db.collection('jugadores').add(jugadorData);
                
                // Mostrar mensaje de éxito
                mostrarAlerta('Jugador registrado exitosamente', 'success');
                
                // Limpiar formulario
                document.getElementById('form-jugador').reset();
                
                // Recargar jugadores
                await cargarJugadores();
                actualizarDashboard();
                
            } catch (error) {
                console.error('Error registrando jugador:', error);
                mostrarAlerta('Error al registrar jugador', 'error');
            }
        });

        document.getElementById('form-juego').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const juegoData = {
                    fecha: firebase.firestore.Timestamp.fromDate(new Date(document.getElementById('fecha-juego').value)),
                    equipoContrarioId: document.getElementById('equipo-contrario').value,
                    carrerasYayeros: parseInt(document.getElementById('carreras-yayeros').value),
                    carrerasContrario: parseInt(document.getElementById('carreras-contrario').value),
                    ubicacion: document.getElementById('ubicacion-juego').value,
                    esLocal: document.getElementById('es-local').value === 'true',
                    ganado: parseInt(document.getElementById('carreras-yayeros').value) > parseInt(document.getElementById('carreras-contrario').value),
                    innings: 7
                };
                
                await db.collection('juegos').add(juegoData);
                
                mostrarAlerta('Juego registrado exitosamente', 'success');
                document.getElementById('form-juego').reset();
                
                await cargarJuegos();
                actualizarDashboard();
                
            } catch (error) {
                console.error('Error registrando juego:', error);
                mostrarAlerta('Error al registrar juego', 'error');
            }
        });

        document.getElementById('form-estadisticas').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const estadisticaData = {
                    jugadorId: document.getElementById('jugador-estadistica').value,
                    juegoId: document.getElementById('juego-estadistica').value,
                    turnosAlBate: parseInt(document.getElementById('turnos-bate').value),
                    hits: parseInt(document.getElementById('hits').value),
                    dobles: parseInt(document.getElementById('dobles').value),
                    triples: parseInt(document.getElementById('triples').value),
                    homeRuns: parseInt(document.getElementById('homeruns').value),
                    rbi: parseInt(document.getElementById('rbi').value),
                    sencillos: parseInt(document.getElementById('hits').value) - 
                               parseInt(document.getElementById('dobles').value) - 
                               parseInt(document.getElementById('triples').value) - 
                               parseInt(document.getElementById('homeruns').value)
                };
                
                await db.collection('estadisticas-bateo').add(estadisticaData);
                
                mostrarAlerta('Estadísticas registradas exitosamente', 'success');
                document.getElementById('form-estadisticas').reset();
                
                await cargarEstadisticas();
                actualizarDashboard();
                
            } catch (error) {
                console.error('Error registrando estadísticas:', error);
                mostrarAlerta('Error al registrar estadísticas', 'error');
            }
        });

        // Función para mostrar alertas
        function mostrarAlerta(mensaje, tipo) {
            const alertaExistente = document.querySelector('.alert');
            if (alertaExistente) {
                alertaExistente.remove();
            }
            
            const alerta = document.createElement('div');
            alerta.className = `alert alert-${tipo}`;
            alerta.textContent = mensaje;
            
            document.querySelector('.container').insertBefore(alerta, document.querySelector('.container').firstChild);
            
            setTimeout(() => {
                alerta.remove();
            }, 5000);
        }

        // Funciones placeholder para acciones adicionales
        function editarJugador(jugadorId) {
            // Implementar edición de jugador
            console.log('Editar jugador:', jugadorId);
        }

        function verDetallesJuego(juegoId) {
            // Implementar vista de detalles del juego
            console.log('Ver detalles del juego:', juegoId);
        }

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatosIniciales();
        });

        // Función para actualizar premios anuales
function actualizarPremiosAnuales() {
    if (estadisticas.length === 0 || jugadores.length === 0) {
        // Si no hay estadísticas, mostrar valores por defecto
        document.getElementById('mvp-jugador').textContent = 'TBD';
        document.getElementById('hr-leader').textContent = '0';
        document.getElementById('avg-leader').textContent = '.000';
        document.getElementById('rbi-leader').textContent = '0';
        return;
    }
    
    // Agrupar estadísticas por jugador
    const estadisticasPorJugador = {};
    estadisticas.forEach(est => {
        if (!estadisticasPorJugador[est.jugadorId]) {
            estadisticasPorJugador[est.jugadorId] = {
                turnosAlBate: 0,
                hits: 0,
                homeRuns: 0,
                rbi: 0,
                dobles: 0,
                triples: 0
            };
        }
        estadisticasPorJugador[est.jugadorId].turnosAlBate += est.turnosAlBate || 0;
        estadisticasPorJugador[est.jugadorId].hits += est.hits || 0;
        estadisticasPorJugador[est.jugadorId].homeRuns += est.homeRuns || 0;
        estadisticasPorJugador[est.jugadorId].rbi += est.rbi || 0;
        estadisticasPorJugador[est.jugadorId].dobles += est.dobles || 0;
        estadisticasPorJugador[est.jugadorId].triples += est.triples || 0;
    });
    
    // Convertir a array con información del jugador
    const jugadoresConStats = Object.keys(estadisticasPorJugador).map(jugadorId => {
        const jugador = jugadores.find(j => j.id === jugadorId);
        const stats = estadisticasPorJugador[jugadorId];
        const promedio = stats.turnosAlBate > 0 ? (stats.hits / stats.turnosAlBate) : 0;
        
        // Calcular puntos MVP (fórmula simple: promedio * 100 + homeRuns * 10 + rbi * 2)
        const puntosMVP = (promedio * 100) + (stats.homeRuns * 10) + (stats.rbi * 2);
        
        return {
            jugadorId: jugadorId,
            nombre: jugador ? `${jugador.nombre} ${jugador.apellido}` : 'N/A',
            nombreCorto: jugador ? `#${jugador.numeroJugador} ${jugador.nombre}` : 'N/A',
            numeroJugador: jugador ? jugador.numeroJugador : '0',
            promedio: promedio,
            homeRuns: stats.homeRuns,
            rbi: stats.rbi,
            hits: stats.hits,
            puntosMVP: puntosMVP,
            turnosAlBate: stats.turnosAlBate
        };
    });
    
    // Filtrar jugadores con al menos 10 turnos al bate para promedios válidos
    const jugadoresElegibles = jugadoresConStats.filter(j => j.turnosAlBate >= 10);
    
    // Encontrar líderes
    let mvpJugador = 'TBD';
    let liderHomeRuns = { nombre: 'TBD', homeRuns: 0 };
    let mejorPromedio = { nombre: 'TBD', promedio: 0 };
    let liderRBI = { nombre: 'TBD', rbi: 0 };
    
    if (jugadoresConStats.length > 0) {
        // MVP - jugador con más puntos MVP
        const mvp = jugadoresConStats.reduce((max, jugador) => 
            jugador.puntosMVP > max.puntosMVP ? jugador : max
        );
        mvpJugador = mvp.nombreCorto;
        
        // Líder en Home Runs
        const hrLeader = jugadoresConStats.reduce((max, jugador) => 
            jugador.homeRuns > max.homeRuns ? jugador : max
        );
        liderHomeRuns = { 
            nombre: hrLeader.nombreCorto, 
            homeRuns: hrLeader.homeRuns 
        };
        
        // Líder en RBI
        const rbiLeader = jugadoresConStats.reduce((max, jugador) => 
            jugador.rbi > max.rbi ? jugador : max
        );
        liderRBI = { 
            nombre: rbiLeader.nombreCorto, 
            rbi: rbiLeader.rbi 
        };
        
        // Mejor promedio (solo jugadores elegibles con mínimo de turnos)
        if (jugadoresElegibles.length > 0) {
            const avgLeader = jugadoresElegibles.reduce((max, jugador) => 
                jugador.promedio > max.promedio ? jugador : max
            );
            mejorPromedio = { 
                nombre: avgLeader.nombreCorto, 
                promedio: avgLeader.promedio 
            };
        }
    }
    
    // Actualizar elementos del DOM con formato mejorado
    document.getElementById('mvp-jugador').innerHTML = mvpJugador;
    
    // Para Home Runs - mostrar número grande y nombre pequeño debajo
    const hrElement = document.getElementById('hr-leader');
    if (liderHomeRuns.homeRuns > 0) {
        hrElement.innerHTML = `${liderHomeRuns.homeRuns}<br><small style="font-size: 0.6em; opacity: 0.8;">${liderHomeRuns.nombre}</small>`;
    } else {
        hrElement.innerHTML = '0';
    }
    
    // Para Promedio - mostrar promedio grande y nombre pequeño debajo
    const avgElement = document.getElementById('avg-leader');
    if (mejorPromedio.promedio > 0) {
        avgElement.innerHTML = `${mejorPromedio.promedio.toFixed(3)}<br><small style="font-size: 0.6em; opacity: 0.8;">${mejorPromedio.nombre}</small>`;
    } else {
        avgElement.innerHTML = '.000';
    }
    
    // Para RBI - mostrar número grande y nombre pequeño debajo
    const rbiElement = document.getElementById('rbi-leader');
    if (liderRBI.rbi > 0) {
        rbiElement.innerHTML = `${liderRBI.rbi}<br><small style="font-size: 0.6em; opacity: 0.8;">${liderRBI.nombre}</small>`;
    } else {
        rbiElement.innerHTML = '0';
    }
}

// Función mejorada para actualizar dashboard (incluye premios)
function actualizarDashboard() {
    // Total jugadores
    document.getElementById('total-jugadores').textContent = jugadores.length;
    
    // Total juegos
    document.getElementById('total-juegos').textContent = juegos.length;
    
    // Total victorias
    const victorias = juegos.filter(juego => juego.carrerasYayeros > juego.carrerasContrario).length;
    document.getElementById('total-victorias').textContent = victorias;
    
    // Calcular promedio del equipo
    if (estadisticas.length > 0) {
        const totalTurnos = estadisticas.reduce((sum, est) => sum + (est.turnosAlBate || 0), 0);
        const totalHits = estadisticas.reduce((sum, est) => sum + (est.hits || 0), 0);
        const promedioEquipo = totalTurnos > 0 ? (totalHits / totalTurnos).toFixed(3) : '.000';
        document.getElementById('promedio-equipo').textContent = promedioEquipo;
    }
    
    // Actualizar tabla de líderes
    actualizarLideresBateo();
    
    // Actualizar premios anuales
    actualizarPremiosAnuales();
}
    </script>
</body>
</html>
